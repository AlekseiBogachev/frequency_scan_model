\section{Реализация моделей}
	В данном разделе приводится краткое описание программной реализации
	моделей, примеры рассчитанных частотных сканов, примеры результатов
	идентификации их моделей, рассматриваются некоторые методические вопросы.


	\subsection{Интерфейс и функционал}
	Модели оформлены в виде пакета модулей на языке программирования Python~3.
	Интерфейс моделей совместим с одной из самых популярных библиотек для 
	машинного обучения scikit-learn \cite{sklearn_website}. Такое техническое
	решение позволяет использовать имеющиеся в библиотеке инструменты 
	предобработки данных, оценки качества и оптимизации параметров 
	моделей, а также интегрировать модели в друге программное обеспечение и 
	конвейеры обработки данных.

	Разработанные модели (выражения	\ref{eq:dls82e_model_S_short}, 
	\ref{eq:dls82e_model_S_p}, \ref{eq:multiexp_frequncy_scan}), выполняют две 
	функции:
	\begin{enumerate}
		\item Вычисление частотного скана с заданными параметрами.
		\item Идентификация параметров модели частотного скана по 
		экспериментальным данным.
	\end{enumerate}
	Идентификация параметров моделей реализована методом градиентного спуска.
	Имеется возможность вывода значений параметров модели на каждой итерации.
	Реализована автоматическая остановка идентификации при достижении заданного
	модуля разницы между значениями функции потерь на текущей и предыдущей 
	итерации.

	Модели реализуют единообразный интерфейс. При инициализации каждая модель 
	получает длительность импульса заполнения (параметр filling\_pulse),
	которая считается неизменной при измерениях) и параметры алгоритма 
	идентификации. Параметры алгоритма идентификации варьируются:
	\begin{itemize}
		\item модель идеального частотного скана и модель частотного скана с 
		показателем нелинейности-неэкспоненциальности (выражения 
		\ref{eq:dls82e_model_S_short}, \ref{eq:dls82e_model_S_p}): 
			\begin{description}
				\item[fit\_p\_coef] -- если параметр принимает значение True 
				(логическую единицу), тогда при идентификации параметров модели
				определяется показатель нелинейности-неэкспоненциальности $p$,
				иначе (False -- логический ноль) $p$ считается равным 1 и не 
				изменяется при идентификации параметров модели;
				\item[learning\_rate] -- скорость градиентного спуска;
				\item[n\_iters] -- максимальное количесво итераций при 
				идентификации;
				\item[stop\_val] -- модуль разницы между значениями функции 
				потерь на текущей и предыдущей итерации, при достижении которого
				происходит остановка идентификации;
				\item[verbose] -- если параметр принимает значение True, то в 
				стандартный поток вывода печатаются значения параметров модели
				на каждой итерации.
			\end{description}

		\item модель многоэкспоненциального частотного скана (выражение 
		\ref{eq:multiexp_frequncy_scan}):
			\begin{description}
				\item[n\_exps] -- количество экспоненециальных составляющих в 
				сигнале релаксации (значение $n$ в выражении 
				\ref{eq:multiexp_frequncy_scan});
				\item[learning\_rate] -- скорость градиентного спуска;
				\item[n\_iters] -- максимальное количесво итераций при 
				идентификации;
				\item[stop\_val] -- модуль разницы между значениями функции 
				потерь на текущей и предыдущей итерации, при достижении которого
				происходит остановка идентификации;
				\item[verbose] -- если параметр принимает значение True, то в 
				стандартный поток вывода печатаются значения параметров модели
				на каждой итерации.
			\end{description}
	\end{itemize}

	При идентификации параметров модели идеального частотного скана 
	определяется амплитуда и десятичный логарифм постоянной времени 
	($\log_{10}(\tau)$) сигнала релаксации. Причины замены постоянной времени
	её десятичном логарифмом объясняются в следующем разделе.

	При идентификации модели с показателем нелинейности"=неэкспоненциальности
	к амплитуде и десятичному логарифму постоянной времени сигнала релаксации
	добавляется значение показателя нелинейности"=неэкспоненциальности $p$.

	При идентификации многоэкспоненциальной модели определяется $n$ пар 
	амплитуда --- десятичный логарифм постоянной времени сигнала релаксации. 
	По паре для каждой из $n$ экспоненциальных составляющих.

	Параметры модели частотного скана могут быть не только идентифицированны,
	но и заданы пользователем.

	Чтобы выполнить идентификацию параметров модели, нужно передать ей 
	набор экспериментальных (тренировачных) данных, состоящих из вектора 
	значений десятичных логарифимов частоты опорной функции ($\log_{10}(F_0)$)
	и соответствующего вектора значений сигнала DLTS -- сигнала на выходе 
	аппаратного тракта спектрометра DLS-82E. При идентификации параметров модели
	по умолчанию их начальные параметры выбираются случайным образом, однако
	могут быть и определены пользователем.

	При идентификации модели значения её параметров на каждой итерации 
	сохраняются в атрибуте fit\_results\_, что позволяет пользователю
	получить и проанализировать данные о работе алгоритма идентификации.

	При вычислении частотного скана с заданными параметрами модели передаётся
	вектор значений десятичных логарифимов частоты опорной функции, для каждого 
	из которых модель вычислит значение сигнала	DLTS.


	\subsection{Алгоритм идентификации параметров моделей}
	Идентификация параметров модели производится методом градиетного 
	спуска, при этом минимизируется среднеквадратическая ошибка между 
	значениями, полученными в результате измерений, и результатами 
	моделирования (выражение \ref{eq:mse}).
	\begin{equation}
		\label{eq:mse}
		E = \frac{1}{m}\sum_{i=1}^{m}\left(y_i - y_i^*\right)^2,
	\end{equation}
	где
	\begin{description}
		\item[$y_i$] -- значения, полученные в результате измерений,
		\item[$y_i^*$] -- значения, полученные в результате моделирования,
		\item[$m$] -- количество измерений.
	\end{description}
	При каждом обновлении постоянной времени сигнала релаксации (как при 
	идентификации модели, на каждой итерации, так и при обновлении постоянной 
	времени пользователем) вычисляется масштабный множитель $M(\tau, F_0, t_1)$, 
	определяемый выражением \ref{eq:dls82e_model_M}. Таким образом модель 
	всякий раз вычисляет значение 	
	\(
		\max{\left[
	    \tau F_0 e^{-\frac{0.05}{\tau F_0}}
	    \left(1-e^{\frac{t_1 F_0-0.45}{\tau F_0}}
	    -e^{-\frac{0.5}{\tau F_0}}+
	    e^{\frac{t_1 F_0-0.95}{\tau F_0}}\right)
	    \right]}
    \).
    В текущей реализации моделей данный максимум вычисляется приблизительно
    с помощью градиентного спуска. Не смотря на то, что применяемый итеративный
    алгоритм находит максимум очень быстро, эти вычисления занимают довольно 
    много веремени при идентификации моделей, потому что выполняются на 
    каждой итерации (при каждом обновлений постоянной времени $\tau$). В случае 
    многоэкспоненциальной модели данный процесс повторяется еще и для каждой 
    экспоненциальной составляющей, что заметно снижает скорость идентификации 
    модели при значениях параметра n\_exps больше 10. Таким образом в будущем 
    вычисления можно будет оптимизировать за счёт одного из следющих решений:
    \begin{enumerate}
    	\item найти точное аналитическое выражение для расчёта 
    	$M(\tau, F_0, t_1)$,
    	\item найти для $M(\tau, F_0, t_1)$ аппроксимирующую функцию, 
    	позволяющую вычислять мастабный множитель с приемлимой точностью.
    \end{enumerate}

	В моделях градиентный спуск реализован при помощи библиотеки TensorFlow
	\cite{tf_website}, главное преимущество которой в том, что она реализует
	алгоритм автоматического дифференцирования на графе вычислений. Таким 
	образом, при расчёте градиентов сначала производные берутся символьно 
	(точно), а затем вычисляются их значения, поэтому точность вычисления 
	градиента ограничена только разрядностью чисел \cite{hands_on_ml},
	\cite{nikolenko_deep_learning}, \cite{tf_website}.

	Во всех моделях используется алгоритм идентификации с постоянной и одинаковой
	для всех параметров скроростью градиентного спуска, поэтому для ускорения 
	идентификации параметров моделей и улучшения сходимости алгоритма необходима 
	нормализация (прведение к единому масштабу) тренировочных данных.
	
	\begin{figure}[!htp]
		\centering
		\includegraphics[width=\textwidth]{path_example}
		\caption{Градиентный спуск с нормализацией тренировачных данных (график
		слева) и без неё (график справа) для модели с двумя параметрами. $a$ и 
		$b$ -- параметры модели, $E$ -- функция потерь.}
		\label{pic:path_example}
	\end{figure}

	Рассмотрим примеры на рисунке \ref{pic:path_example}. В идеальном случае 
	функция потерь (среднеквадратическая ошика -- выражение \ref{eq:mse}) должна
	иметь форму <<симметричной чаши>>, а изменение обоих параметров должно вносить 
	одинаковый вклад в значение градиента. В таком случае алгоритм градиентного 
	спуска достигнет минимума функции потерь кратчайшим путём, как на левом 
	графике рисунка \ref{pic:path_example}. Если же тренировочные данные имеют
	очень разные масштабы, функция потерь (гафик справа на рисунке 
	\ref{pic:path_example}) будет иметь форму <<вытянутой чаши>>, а алгоритм 
	идентификации будет долго подстраивать одни из параметров без существенного
	изменения функции потерь \cite{hands_on_ml}. Чтобы минимизировать этот 
	эффект,	тренировочные данные нормализуют перед идентификацей параметров 
	модели. После идентификации параметры модели и тренировочные данные можно
	вернуть в исходный масштаб.

	Для разрабатанных моделей тренировочные данные данные имеют существенно
	отличающиеся масштабы: значение сигнала DLTS находятся в диапазоне долей
	пикофарад, а диапазон изменения частоты опорной функции спектрометра
	покрывает три декады (от 1 Гц до 2500 кГц). Таким образом, желательно 
	выполнять нормализацию исходных данных перед идентификацией параметров
	модели. Кроме этого, изменение параметров модели (постоянной времени и 
	амплитуды) вносят существенно различающийся вклад в градиент функции потерь.
	Если снова обратиться к выражениям \ref{eq:dls82e_model_phi} и 
	\ref{eq:dls82e_model_S_short}, можно заметить, что значение функции потерь
	пропорционально первой степени амплитуды $A$ сигнала релаксации и экспоненте,
	возведенной в степень скорости экспоненциального спада, то есть
	$e^\frac{1}{\tau}$. Поэтому на вход моделей при идентификации подаётся 
	десятичный логарифм частоты опорной функции ($\log_{10}(F_0)$), а 
	идентификация производится не по постоянной времени $\tau$, а по десятичному
	логарифму постоянной времени $\log_{10}(\tau)$. На рисунке \ref{pic:path}
	показан приемер идентификации идельного частотного скана. <<Путь>> 
	параметров модели в процессе идентификации показывает красная линия с 
	маркерами, а изолинии и градиент -- значения функции потерь.

    \begin{figure}[!htp]
        \centering
        \includegraphics[width=0.75\textwidth]{path}
        \caption{<<Путь>> значений параметров при идентификации.}
        \label{pic:path}
    \end{figure}

    На рисунке \ref{pic:path} форма изолиний отличается от концентрических 
    окружностей, а <<путь>> параметров не похож на прямую линию, что говорит
    о том, что возможна дальнейшая оптимизация алгоритма идентификации, однако,
    названные выше меры позволили значительно смягчить эффект от различных 
    масштабов в экспериментальных данных и в параметрах модели. Также возможно
    использование одного из алгоритмов адаптивного градиентного спуска, то есть
    алгоритмов изменяющих скорость по мере приближения к оптимальным значениям
    параметров. Такое решение не изменит форму функции потерь, но оптимизирует
    <<путь>> и количество итераций.

    Рисунки \ref{pic:identification_test} и \ref{pic:multiexp_test} показывают
    примеры результатов идентификации модели идеального частотного скана и 
    модели многоэкспоненциального частотного скана соответственно на 
    расчитанных тренировочных данных.

    \begin{figure}[!htp]
        \centering
        \includegraphics[width=0.75\textwidth]{identification_test}
        \caption{Пример результата идентификации модели идеального частотного 
        скана.}
        \label{pic:identification_test}
    \end{figure}


    \begin{figure}[!htp]
        \centering
        \includegraphics[width=0.75\textwidth]{multiexp_test}
        \caption{Пример результата идентификации модели многоэкспоненциального
        частотного скана. Штрихпунктирными линиями показаны частотные сканы для
        отдельных экспоненциальных составляющих сигнала релаксации.}
        \label{pic:multiexp_test}
    \end{figure}


    \subsection{Оценка качества модели}
    Квартет Энскомба (рисунок \ref{pic:anscombe_quartet}) 
    \cite{anscombe_quartet_wikipedia}, \cite{anscombe_quartet_article}.

    \begin{figure}[!htp]
        \centering
        \includegraphics[width=0.75\textwidth]{anscombe_quartet}
        \caption{Квартет Энскомба.}
        \label{pic:anscombe_quartet}
    \end{figure}

    Несколько слов о рабочем процессе при разработке моделей, оптимизации 
    параметров алгоритма идентификации.	Иллюстрации оверфитинга 
    \cite{hands_on_ml}, \cite{sklearn_cross_validation}.